<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeetCode Problems - 2D Similarity Graph</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        canvas {
            display: block;
            cursor: grab;
        }

        canvas:active {
            cursor: grabbing;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(30, 30, 30, 0.95);
            padding: 20px;
            border-radius: 12px;
            max-width: 350px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(231, 76, 60, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }

        #info-panel h1 {
            font-size: 1.5em;
            margin-bottom: 10px;
            color: #e74c3c;
        }

        #info-panel p {
            font-size: 0.9em;
            color: #aaa;
            line-height: 1.6;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 30, 30, 0.95);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(231, 76, 60, 0.3);
            z-index: 10;
        }

        .legend h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            color: #e74c3c;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 0.85em;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }

        #tooltip {
            position: absolute;
            background: rgba(30, 30, 30, 0.98);
            padding: 16px 20px;
            border-radius: 12px;
            pointer-events: none;
            display: none;
            font-size: 0.9em;
            border: 2px solid rgba(231, 76, 60, 0.6);
            max-width: 450px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);
            z-index: 1000;
            line-height: 1.5;
        }

        #tooltip .title {
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 4px;
        }

        #tooltip .meta {
            color: #aaa;
            font-size: 0.9em;
        }

        #tooltip .description {
            margin-top: 10px;
            color: #ccc;
            font-size: 0.9em;
            line-height: 1.4;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            padding-top: 10px;
        }

        #tooltip .keywords {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.85em;
        }

        .keyword-tag {
            display: inline-block;
            background: rgba(231, 76, 60, 0.3);
            color: #f39c12;
            padding: 3px 10px;
            border-radius: 6px;
            margin: 3px;
            font-size: 0.85em;
            font-weight: 600;
        }

        #edge-tooltip {
            position: absolute;
            background: rgba(231, 76, 60, 0.95);
            padding: 8px 12px;
            border-radius: 6px;
            pointer-events: none;
            display: none;
            font-size: 0.8em;
            color: white;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
            z-index: 999;
            font-weight: 600;
        }

        .edge-label {
            display: block;
            margin: 2px 0;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 0.85em;
            margin-right: 6px;
        }

        .difficulty-EASY {
            background: #27ae60;
            color: white;
        }

        .difficulty-MEDIUM {
            background: #f39c12;
            color: white;
        }

        .difficulty-HARD {
            background: #e74c3c;
            color: white;
        }

        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.95);
            padding: 15px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(231, 76, 60, 0.3);
            z-index: 10;
        }

        #controls button {
            display: block;
            width: 100%;
            padding: 8px 16px;
            margin: 5px 0;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        #controls button:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }

        #selected-info {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.95);
            padding: 15px;
            border-radius: 12px;
            max-width: 350px;
            max-height: 400px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(231, 76, 60, 0.3);
            display: none;
            z-index: 10;
        }

        #selected-info h3 {
            color: #e74c3c;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .similar-item {
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.85em;
        }

        .similar-item:last-child {
            border-bottom: none;
        }

        .similarity-score {
            color: #f39c12;
            font-weight: 700;
        }

        .category-tag {
            color: #888;
            font-size: 0.85em;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            color: #e74c3c;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="graph-canvas"></canvas>
    </div>

    <div id="info-panel">
        <h1><i class="fas fa-project-diagram"></i> 2D Similarity Graph</h1>
        <p>
            Explore 100 LeetCode problems based on algorithmic similarity.
            <br><br>
            <strong>Hover</strong> to see details<br>
            <strong>Click</strong> to see similar problems<br>
            <strong>Drag</strong> to pan<br>
            <strong>Scroll</strong> to zoom
        </p>
    </div>

    <div class="legend">
        <h3>Difficulty</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: #27ae60;"></div>
            <span>Easy</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #f39c12;"></div>
            <span>Medium</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e74c3c;"></div>
            <span>Hard</span>
        </div>
    </div>

    <div id="controls">
        <button onclick="location.href='index.html'">‚Üê Back to List</button>
        <button onclick="resetView()">Reset View</button>
        <button onclick="showAllProblems()">Clear Selection</button>
    </div>

    <div id="tooltip"></div>
    <div id="edge-tooltip"></div>
    <div id="selected-info"></div>
    <div class="loading" id="loading">Loading graph data...</div>

    <script>
        const canvas = document.getElementById('graph-canvas');
        const ctx = canvas.getContext('2d');

        let problems = [];
        let transform = {
            x: 0,
            y: 0,
            scale: 1
        };

        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        let hoveredProblem = null;
        let selectedProblem = null;
        let hoveredEdge = null;

        const COLORS = {
            EASY: '#27ae60',
            MEDIUM: '#f39c12',
            HARD: '#e74c3c'
        };

        const RADIUS = 8;
        const SELECTED_RADIUS = 12;
        const SIMILAR_RADIUS = 10;

        // Setup canvas
        function setupCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Load data
        fetch('graph_data.json')
            .then(response => response.json())
            .then(data => {
                problems = data;
                document.getElementById('loading').style.display = 'none';

                // Scale embeddings to fit canvas
                scaleEmbeddings();
                centerView();
                draw();
            })
            .catch(error => {
                console.error('Error loading graph data:', error);
                document.getElementById('loading').textContent = 'Error loading data';
            });

        function scaleEmbeddings() {
            // Find min/max of embeddings
            let minX = Infinity, maxX = -Infinity;
            let minY = Infinity, maxY = -Infinity;

            problems.forEach(p => {
                minX = Math.min(minX, p.embedding[0]);
                maxX = Math.max(maxX, p.embedding[0]);
                minY = Math.min(minY, p.embedding[1]);
                maxY = Math.max(maxY, p.embedding[1]);
            });

            const rangeX = maxX - minX;
            const rangeY = maxY - minY;
            const scale = Math.min(canvas.width, canvas.height) * 0.35;

            problems.forEach(p => {
                p.x = ((p.embedding[0] - minX) / rangeX - 0.5) * scale * 2;
                p.y = ((p.embedding[1] - minY) / rangeY - 0.5) * scale * 2;
            });
        }

        function centerView() {
            transform.x = canvas.width / 2;
            transform.y = canvas.height / 2;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(transform.x, transform.y);
            ctx.scale(transform.scale, transform.scale);

            // Draw similarity lines if selected
            if (selectedProblem) {
                selectedProblem.similar.forEach((sim, idx) => {
                    const target = problems.find(p => p.num === sim.num);
                    if (target) {
                        const isHovered = hoveredEdge &&
                                         hoveredEdge.from === selectedProblem.num &&
                                         hoveredEdge.to === sim.num;

                        ctx.strokeStyle = isHovered
                            ? `rgba(231, 76, 60, 0.9)`
                            : `rgba(231, 76, 60, ${sim.similarity * 0.5})`;
                        ctx.lineWidth = (isHovered ? 4 : 2) / transform.scale;
                        ctx.beginPath();
                        ctx.moveTo(selectedProblem.x, selectedProblem.y);
                        ctx.lineTo(target.x, target.y);
                        ctx.stroke();

                        // Store edge info for hover detection
                        if (!target.edgeInfo) target.edgeInfo = [];
                        target.edgeInfo.push({
                            from: selectedProblem,
                            to: target,
                            similarity: sim
                        });
                    }
                });
            }

            // Draw problems
            problems.forEach(problem => {
                let radius = RADIUS;
                let alpha = 0.8;

                if (selectedProblem) {
                    if (problem.num === selectedProblem.num) {
                        radius = SELECTED_RADIUS;
                        alpha = 1;
                    } else if (selectedProblem.similar.some(s => s.num === problem.num)) {
                        radius = SIMILAR_RADIUS;
                        alpha = 0.9;
                    } else {
                        alpha = 0.3;
                    }
                }

                if (hoveredProblem && problem.num === hoveredProblem.num) {
                    radius += 2;
                }

                ctx.fillStyle = COLORS[problem.difficulty];
                ctx.globalAlpha = alpha;
                ctx.beginPath();
                ctx.arc(problem.x, problem.y, radius / transform.scale, 0, Math.PI * 2);
                ctx.fill();

                // Stroke for better visibility
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 1 / transform.scale;
                ctx.stroke();
            });

            ctx.globalAlpha = 1;
            ctx.restore();

            requestAnimationFrame(draw);
        }

        // Mouse events
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const problem = findProblemAtPosition(mouseX, mouseY);

            if (problem) {
                selectProblem(problem);
            } else {
                isDragging = true;
                dragStart = { x: mouseX - transform.x, y: mouseY - transform.y };
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            if (isDragging) {
                transform.x = mouseX - dragStart.x;
                transform.y = mouseY - dragStart.y;
            } else {
                const problem = findProblemAtPosition(mouseX, mouseY);
                hoveredProblem = problem;

                const tooltip = document.getElementById('tooltip');
                const edgeTooltip = document.getElementById('edge-tooltip');

                if (problem) {
                    const keywordTags = problem.keywords.slice(0, 5).map(kw =>
                        `<span class="keyword-tag">${kw.term}</span>`
                    ).join('');

                    tooltip.innerHTML = `
                        <div class="title">#${problem.num}: ${problem.title}</div>
                        <div class="meta">
                            <span class="difficulty-badge difficulty-${problem.difficulty}">${problem.difficulty}</span>
                            ${problem.category} | ${problem.frequency}%
                        </div>
                        <div class="description">
                            ${problem.description || 'No description available'}
                        </div>
                        <div class="keywords">
                            üéØ Key Features: ${keywordTags}
                        </div>
                    `;
                    tooltip.style.display = 'block';
                    tooltip.style.left = e.clientX + 15 + 'px';
                    tooltip.style.top = e.clientY + 15 + 'px';

                    // Check for edge hover
                    if (selectedProblem && problem.num !== selectedProblem.num) {
                        const simInfo = selectedProblem.similar.find(s => s.num === problem.num);
                        if (simInfo) {
                            hoveredEdge = { from: selectedProblem.num, to: problem.num };

                            const sharedKw = simInfo.shared_keywords || [];
                            let tooltipContent = `<div class="edge-label">üìä Similarity: ${(simInfo.similarity * 100).toFixed(1)}%</div>`;

                            if (sharedKw.length > 0) {
                                // Format shared keywords nicely
                                const formattedKw = sharedKw.map(kw =>
                                    `<strong>${kw}</strong>`
                                ).join(', ');
                                tooltipContent += `<div class="edge-label">üéØ Common: ${formattedKw}</div>`;
                            } else {
                                tooltipContent += `<div class="edge-label" style="font-size: 0.9em; opacity: 0.8;">Similar approach/pattern</div>`;
                            }

                            edgeTooltip.innerHTML = tooltipContent;
                            edgeTooltip.style.display = 'block';
                            edgeTooltip.style.left = e.clientX + 15 + 'px';
                            edgeTooltip.style.top = (e.clientY - 70) + 'px';
                        } else {
                            hoveredEdge = null;
                            edgeTooltip.style.display = 'none';
                        }
                    } else {
                        hoveredEdge = null;
                        edgeTooltip.style.display = 'none';
                    }
                } else {
                    tooltip.style.display = 'none';
                    edgeTooltip.style.display = 'none';
                    hoveredEdge = null;
                }
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const zoom = e.deltaY < 0 ? 1.1 : 0.9;
            const newScale = Math.max(0.1, Math.min(5, transform.scale * zoom));

            // Zoom towards mouse position
            transform.x = mouseX - (mouseX - transform.x) * (newScale / transform.scale);
            transform.y = mouseY - (mouseY - transform.y) * (newScale / transform.scale);
            transform.scale = newScale;
        });

        function findProblemAtPosition(mouseX, mouseY) {
            const worldX = (mouseX - transform.x) / transform.scale;
            const worldY = (mouseY - transform.y) / transform.scale;

            for (const problem of problems) {
                const dx = worldX - problem.x;
                const dy = worldY - problem.y;
                const distance = Math.sqrt(dx * dx + dy * dy);

                let radius = RADIUS;
                if (selectedProblem && problem.num === selectedProblem.num) {
                    radius = SELECTED_RADIUS;
                } else if (selectedProblem && selectedProblem.similar.some(s => s.num === problem.num)) {
                    radius = SIMILAR_RADIUS;
                }

                if (distance < radius / transform.scale) {
                    return problem;
                }
            }
            return null;
        }

        function selectProblem(problem) {
            selectedProblem = problem;

            const panel = document.getElementById('selected-info');
            panel.style.display = 'block';

            const keywordList = problem.keywords.slice(0, 6).map(kw =>
                `<span class="keyword-tag">${kw.term}</span>`
            ).join('');

            panel.innerHTML = `
                <h3>#${problem.num}: ${problem.title}</h3>
                <div style="margin: 10px 0; color: #aaa;">
                    <span class="difficulty-badge difficulty-${problem.difficulty}">${problem.difficulty}</span>
                    ${problem.category}
                </div>
                <div style="margin: 10px 0;">
                    <div style="color: #f39c12; font-weight: 600; margin-bottom: 6px;">üéØ Key Recognition Features:</div>
                    ${keywordList}
                </div>
                <div style="margin: 10px 0; color: #aaa;">üìö Similar Problems for Practice:</div>
                ${problem.similar.slice(0, 8).map(s => `
                    <div class="similar-item">
                        <span class="similarity-score">${(s.similarity * 100).toFixed(1)}%</span>
                        - #${s.num}: ${s.title}
                        <div class="category-tag">‚îî‚îÄ ${s.category}</div>
                    </div>
                `).join('')}
            `;
        }

        function resetView() {
            centerView();
            transform.scale = 1;
        }

        function showAllProblems() {
            selectedProblem = null;
            hoveredProblem = null;
            document.getElementById('selected-info').style.display = 'none';
        }

        window.addEventListener('resize', () => {
            setupCanvas();
            scaleEmbeddings();
            draw();
        });

        setupCanvas();
    </script>
</body>
</html>
